"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.checkDeps = void 0;
const pyUtils_1 = require("./pyUtils");
const semver_1 = require("semver");
const minPyVersion = semver_1.coerce('3.8');
const pythonErrMsg = 'You must have python >= 3.8 installed and available on your PATH as "python3" or "python". It can be installed from https://www.python.org/downloads';
const pipenvErrMsg = 'You must have pipenv installed and available on your PATH as "pipenv". It can be installed by running "pip3 install --user pipenv".';
async function checkDeps() {
    let hasDeps = true;
    let errMsg = '';
    const pyBinary = pyUtils_1.getPythonBinaryName();
    if (!pyBinary) {
        hasDeps = false;
        errMsg = `Could not find "python3" or "python" executable in the PATH.`;
    }
    else {
        try {
            const pyVersionStr = await pyUtils_1.execAsStringPromise(`${pyBinary} --version`);
            const pyVersion = semver_1.coerce(pyVersionStr);
            if (!pyVersion || semver_1.lt(pyVersion, minPyVersion)) {
                hasDeps = false;
                errMsg = `${pyBinary} found but version ${pyVersionStr} is less than the minimum required version.\n${pythonErrMsg}`;
            }
        }
        catch (err) {
            hasDeps = false;
            errMsg = `Error executing ${pyBinary}\n${pythonErrMsg}`;
        }
    }
    try {
        await pyUtils_1.execAsStringPromise('pipenv --version');
    }
    catch (err) {
        hasDeps = false;
        errMsg = errMsg.concat(errMsg ? '\n' : '', pipenvErrMsg);
    }
    return Promise.resolve({ hasRequiredDependencies: hasDeps, errorMessage: errMsg });
}
exports.checkDeps = checkDeps;
//# sourceMappingURL=depUtils.js.map