"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.lambdasWithApiDependency = void 0;
const loadFunctionParameters_1 = require("./loadFunctionParameters");
const path_1 = __importDefault(require("path"));
const constants_1 = require("../../../constants");
async function lambdasWithApiDependency(context, allResources, backendDir, modelsDeleted) {
    let dependentFunctions = [];
    const lambdaFuncResources = allResources.filter(resource => resource.service === "Lambda" &&
        resource.mobileHubMigrated !== true &&
        resource.dependsOn !== undefined &&
        resource.dependsOn.find(val => val.category === 'api'));
    for (const lambda of lambdaFuncResources) {
        const resourceDirPath = path_1.default.join(backendDir, constants_1.category, lambda.resourceName);
        const currentParameters = loadFunctionParameters_1.loadFunctionParameters(context, resourceDirPath);
        const selectedCategories = currentParameters.permissions;
        let deletedModelFound;
        for (const selectedResources of Object.values(selectedCategories)) {
            deletedModelFound = Object.keys(selectedResources).some(r => modelsDeleted.includes(r));
            if (deletedModelFound) {
                dependentFunctions.push(lambda);
            }
        }
    }
    return dependentFunctions;
}
exports.lambdasWithApiDependency = lambdasWithApiDependency;
//# sourceMappingURL=getDependentFunction.js.map